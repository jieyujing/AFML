# AFML é¡¹ç›®è¿›åº¦æŠ¥å‘Š

## âœ… å·²å®Œæˆå·¥ä½œ

### 1. Dollar Bars ç”Ÿæˆ âœ“
**æ–‡ä»¶**: `src/process_bars.py`

å·²æˆåŠŸå®ç°ä¸¤ç§ç±»å‹çš„ dollar bars:
- **Fixed Dollar Bars**: ä½¿ç”¨å›ºå®šé˜ˆå€¼
- **Dynamic Dollar Bars**: ä½¿ç”¨ EMA åŠ¨æ€é˜ˆå€¼

**è¾“å‡ºæ–‡ä»¶**:
- `dynamic_dollar_bars.csv` - 3,927 ä¸ª dollar bars
- æ—¶é—´èŒƒå›´: 2022-01-04 è‡³ 2026-01-20

**å…³é”®å‘ç°**:
- Dollar bars æˆåŠŸé™ä½äº† Jarque-Bera ç»Ÿè®¡é‡
- æ”¶ç›Šåˆ†å¸ƒæ›´æ¥è¿‘æ­£æ€åˆ†å¸ƒ
- åŠ¨æ€é˜ˆå€¼è¡¨ç°ä¼˜äºå›ºå®šé˜ˆå€¼

---

### 2. Triple Barrier Labeling âœ“
**æ–‡ä»¶**: `src/labeling.py`

å®ç°äº† AFML æ ¸å¿ƒçš„ä¸‰é‡éšœç¢æ ‡ç­¾æ³•:
- **ä¸Šéšœç¢**: æ­¢ç›ˆ (1x æ³¢åŠ¨ç‡)
- **ä¸‹éšœç¢**: æ­¢æŸ (1x æ³¢åŠ¨ç‡)
- **å‚ç›´éšœç¢**: æ—¶é—´é™åˆ¶ (12 bars â‰ˆ 3 days)

**è¾“å‡ºæ–‡ä»¶**:
- `labeled_events.csv` - 3,707 ä¸ªæ ‡è®°äº‹ä»¶
- `dollar_bars_labeled.csv` - å¸¦æ ‡ç­¾çš„å®Œæ•´æ•°æ®é›†

**æ ‡ç­¾åˆ†å¸ƒ**:
- Loss (-1): 53.33% (1,977 events)
- Profit (1): 46.67% (1,730 events)

**æ”¶ç›Šç»Ÿè®¡**:
- å¹³å‡æ”¶ç›Š: -0.014%
- æ ‡å‡†å·®: 0.907%
- èŒƒå›´: -3.947% è‡³ 8.880%

**æŒä»“æ—¶é—´**:
- å¹³å‡: 22.51 å°æ—¶
- ä¸­ä½æ•°: 20.33 å°æ—¶
- èŒƒå›´: 0.12 è‡³ 263.88 å°æ—¶

---

### 3. æ ‡ç­¾å¯è§†åŒ–åˆ†æ âœ“
**æ–‡ä»¶**: `src/visualize_labels.py`

ç”Ÿæˆäº†ä¸‰ç»„ç»¼åˆå¯è§†åŒ–:

1. **label_distribution.png**
   - æ ‡ç­¾è®¡æ•°å’Œç™¾åˆ†æ¯”åˆ†å¸ƒ
   - æŒ‰æ ‡ç­¾çš„æ”¶ç›Šåˆ†å¸ƒ
   - æ”¶ç›Šç®±çº¿å›¾

2. **temporal_analysis.png**
   - æ—¶é—´åºåˆ—æ ‡ç­¾åˆ†å¸ƒ
   - æ»šåŠ¨æ ‡ç­¾å¹³è¡¡ (100-bar window)
   - æœˆåº¦æ ‡ç­¾åˆ†å¸ƒ

3. **barrier_analysis.png**
   - æŒä»“æ—¶é—´åˆ†å¸ƒ
   - æŒ‰æ ‡ç­¾çš„æŒä»“æ—¶é—´
   - éšœç¢å®½åº¦(æ³¢åŠ¨ç‡)åˆ†å¸ƒ
   - æ”¶ç›Š vs éšœç¢å®½åº¦æ•£ç‚¹å›¾

---

### 4. ç‰¹å¾å·¥ç¨‹ (Alpha158 + FFD Momentum) âœ“
**æ–‡ä»¶**: `src/features.py`

å®ç°äº†æ•´åˆäº†ä¼ ç»Ÿé‡‘èç‰¹å¾å’Œé«˜çº§ ML ç‰¹å¾çš„å·¥ç¨‹ç®¡çº¿ã€‚ç‰¹åˆ«é’ˆå¯¹**è®°å¿†ä¿ç•™ (Memory Preservation)** è¿›è¡Œäº†å¢å¼ºï¼š

**A. Alpha158 ç‰¹å¾é›† (åŸºå‡†å¯¹ç…§)**:
- åŒ…å«ç»å…¸çš„ **ROC/Returns** ç‰¹å¾ï¼ˆç›¸å½“äº $d=1$ æ•´æ•°å·®åˆ†ï¼‰
- è¿™äº›ç‰¹å¾è™½ç„¶å¹³ç¨³ï¼Œä½†å®Œå…¨ä¸¢å¤±äº†ä»·æ ¼çš„é•¿è®°å¿†ä¿¡æ¯
- ç”¨äºä½œä¸ºæ¨¡å‹æ€§èƒ½çš„ Baseline

**B. åˆ†æ•°é˜¶å·®åˆ† (Fractional Differentiation) å¢å¼ºç‰ˆ**:
- **æ ¸å¿ƒç†å¿µ**: ç”¨ FFD æ›¿ä»£ ROC å®ç°æ›´ä¼˜ç§€çš„è¶‹åŠ¿è·Ÿè¸ª
- **FFD Level**: è‡ªåŠ¨å¯»æ‰¾æœ€å° $d$ï¼ˆå¦‚ $d=0.2$ï¼‰çš„å¹³ç¨³ä»·æ ¼åºåˆ—ï¼Œä¿ç•™äº† 80% çš„è®°å¿†
- **FFD Momentum (Trend)**: åœ¨å¹³ç¨³çš„ FFD åºåˆ—ä¸Šè®¡ç®—ç§»åŠ¨å¹³å‡ (`FFD_CLOSE_MAw`)
- **FFD Volatility (Risk)**: åœ¨å¹³ç¨³çš„ FFD åºåˆ—ä¸Šè®¡ç®—æ³¢åŠ¨ç‡ (`FFD_CLOSE_STDw`)
- **FFD Slope**: åœ¨å¹³ç¨³åºåˆ—ä¸Šè®¡ç®—å±€éƒ¨æ–œç‡

**è¾“å‡ºæ–‡ä»¶**:
- `features_labeled.csv` - åŒ…å« Alpha158 + FFD ç‰¹å¾ + æ ‡ç­¾çš„å®Œæ•´æ•°æ®é›†
- ç‰¹å¾æ€»æ•°: ~180 ä¸ª (å¤§å¹…å¢å¼ºäº†ç‰¹å¾ç»´åº¦)

---

### 5. æ ·æœ¬æƒé‡ (Sample Weights) âœ“
**æ–‡ä»¶**: `src/sample_weights.py`

å®ç°äº†é‡‘èæ•°æ®çš„æ ·æœ¬æƒé‡è®¡ç®— (Chapter 4)ï¼Œè§£å†³äº†æ ·æœ¬é‡å  (Concurrency) å¯¼è‡´çš„éç‹¬ç«‹åŒåˆ†å¸ƒé—®é¢˜ï¼š

**æ ¸å¿ƒæŒ‡æ ‡**:
- **Concurrency (å¹¶å‘æ€§)**: è®¡ç®—æ¯ä¸ªæ—¶é—´ç‚¹ä¸Šé‡å çš„æ ‡ç­¾æ•°é‡
- **Average Uniqueness (å¹³å‡å”¯ä¸€æ€§)**: æ ‡ç­¾åœ¨å…¶ç”Ÿå‘½å‘¨æœŸå†…çš„å¹³å‡ç‹¬ç«‹ç¨‹åº¦ (Mean: ~0.90)
- **Sample Weights**: ç»“åˆäº†æ”¶ç›Šç‡å½’å› å’Œå”¯ä¸€æ€§çš„æœ€ç»ˆæƒé‡

**å…³é”®å‘ç°**:
- å¹³å‡å”¯ä¸€æ€§é«˜è¾¾ 0.90ï¼Œè¯´æ˜åœ¨å½“å‰ Barrier è®¾ç½®ä¸‹ï¼Œå¤§éƒ¨åˆ†æ ·æœ¬æ˜¯ç›¸å¯¹ç‹¬ç«‹çš„
- æƒé‡åˆ†å¸ƒå‘ˆç°é•¿å°¾ç‰¹å¾ï¼Œéƒ¨åˆ†é«˜æ”¶ç›Šä¸”ç‹¬ç«‹çš„æ ·æœ¬è·å¾—äº†æé«˜çš„æƒé‡ (Max > 6.0)

**è¾“å‡ºæ–‡ä»¶**:
- `sample_weights.csv` - åŒ…å«å”¯ä¸€æ€§åˆ†æ•°å’Œæœ€ç»ˆæƒé‡
- `features_labeled.csv` - å·²æ›´æ–°ï¼Œæ–°å¢ `sample_weight` å’Œ `avg_uniqueness` åˆ—
- `visual_analysis/weights_distribution.png` - æƒé‡åˆ†å¸ƒå›¾
- `visual_analysis/weights_correlations.png` - æƒé‡ä¸å…¶ä»–å˜é‡çš„ç›¸å…³æ€§

---

### 6. äº¤å‰éªŒè¯ç­–ç•¥ (Cross-Validation) âœ“
**æ–‡ä»¶**: `src/cv_setup.py`

æˆåŠŸå®ç°äº† AFML Chapter 7 çš„ **Purged K-Fold Cross-Validation**ï¼Œç¡®ä¿æ¨¡å‹è¯„ä¼°çš„ä¸¥è°¨æ€§ã€‚

**æ ¸å¿ƒæœºåˆ¶**:
1.  **Purging (æ¸…æ´—)**: åœ¨è®­ç»ƒé›†ä¸­å‰”é™¤æ‰€æœ‰ä¸æµ‹è¯•é›†åœ¨æ—¶é—´ä¸Šæœ‰é‡å çš„æ ·æœ¬ã€‚ç”±äºæˆ‘ä»¬çš„æ ‡ç­¾å…·æœ‰æŒç»­æœŸ (Holding Period)ï¼Œå¦‚æœä¸è¿›è¡Œ Purgingï¼Œè®­ç»ƒé›†ä¸­çš„æ ·æœ¬å¯èƒ½ä¼šåŒ…å«æµ‹è¯•é›†çš„ä¿¡æ¯ï¼ˆLook-ahead Biasï¼‰ã€‚
2.  **Embargo (ç¦è¿)**: åœ¨æµ‹è¯•é›†ä¹‹åè®¾ç«‹äº† **1%** çš„ç¦è¿æœŸï¼Œè¿›ä¸€æ­¥åˆ‡æ–­é•¿è®°å¿†ç‰¹å¾å¯èƒ½å¸¦æ¥çš„ä¿¡æ¯æ³„éœ²ã€‚

**éªŒè¯ç»“æœ**:
- è¿›è¡Œäº† 5-Fold åˆ†å‰²
- è‡ªåŠ¨åŒ–æµ‹è¯•ç¡®è®¤: **æ— æ³„æ¼ (No Leakage Detected)**ã€‚æ‰€æœ‰çš„ Train/Test è¾¹ç•Œéƒ½å·²æ­£ç¡®å¤„ç†ã€‚
- å¯è§†åŒ–éªŒè¯: ç”Ÿæˆäº† `visual_analysis/cv_splits.png`ï¼Œç›´è§‚å±•ç¤ºäº†è®­ç»ƒé›†ä¸æµ‹è¯•é›†ä¹‹é—´çš„â€œéš”ç¦»å¸¦â€ã€‚

---

### 7. åˆæ­¥æ¨¡å‹è®­ç»ƒ (Baseline Model) âœ“
**æ–‡ä»¶**: `src/train_model.py`

å®Œæˆäº†åŸºäº **Random Forest** çš„åŸºå‡†æ¨¡å‹è®­ç»ƒï¼Œå¹¶åœ¨ **Purged K-Fold Cross-Validation** ä¸‹è¿›è¡Œäº†è¯„ä¼°ã€‚

**æ¨¡å‹é…ç½®**:
- **ç®—æ³•**: Random Forest Classifier
- **å‚æ•°**: n_estimators=1000, max_depth=5, class_weight='balanced_subsample', criterion='entropy'
- **éªŒè¯**: 5-Fold Purged CV (1% Embargo)

**æ€§èƒ½æŒ‡æ ‡ (Baseline)**:
- **Accuracy**: 48.84% (+/- 3.42%)
- **F1 Score**: 0.4884 (+/- 0.0341)
- **ROC AUC**: 0.5082 (+/- 0.0248)
- **Log Loss**: 0.8001 (+/- 0.0272)

**ç»“æœåˆ†æ**:
- æ¨¡å‹çš„é¢„æµ‹èƒ½åŠ›ç›®å‰æ¥è¿‘éšæœºçŒœæµ‹ (AUC ~0.50)ï¼Œè¿™æ˜¯é‡‘èæ•°æ®çš„å¸¸è§èµ·ç‚¹ã€‚
- è€ƒè™‘åˆ°ä½¿ç”¨äº†è¾ƒä¸ºä¸¥æ ¼çš„ Purged CVï¼Œè¿™åæ˜ äº†çœŸå®çš„æ³›åŒ–èƒ½åŠ›ï¼Œæ²¡æœ‰è¿‡æ‹Ÿåˆã€‚
- **ç‰¹å¾é‡è¦æ€§**: å·²æå–å¹¶ä¿å­˜è‡³ `feature_importance.csv`ï¼Œå¹¶ç”Ÿæˆäº† `visual_analysis/feature_importance.png`ã€‚

---

### 8. ç‰¹å¾é‡è¦æ€§åˆ†æ (Feature Importance) âœ“
**æ–‡ä»¶**: `src/feature_importance.py`

æˆåŠŸå®ç°äº† AFML Chapter 8 çš„ç‰¹å¾é‡è¦æ€§åˆ†æ,ä½¿ç”¨äº†ä¸¤ç§æ–¹æ³•:

**A. MDI (Mean Decrease Impurity)**:
- å¿«é€Ÿçš„In-sampleæ–¹æ³•
- åŸºäºæ ‘çš„åˆ†è£‚ä¸çº¯åº¦é™ä½
- ä¼˜ç‚¹: è®¡ç®—å¿«é€Ÿ,ç‰¹å¾é‡è¦æ€§æ€»å’Œä¸º1
- ç¼ºç‚¹: å®¹æ˜“è¿‡æ‹Ÿåˆ,å¯¹é«˜åŸºæ•°ç‰¹å¾æœ‰åå‘

**B. MDA (Mean Decrease Accuracy) - é‡‘æ ‡å‡† â­**:
- ç¨³å¥çš„Out-of-sampleæ’åˆ—é‡è¦æ€§æ–¹æ³•
- ä½¿ç”¨ Purged 5-Fold CV é˜²æ­¢ä¿¡æ¯æ³„éœ²
- é€šè¿‡æ’åˆ—ç‰¹å¾æ¥è¡¡é‡æ€§èƒ½ä¸‹é™
- è¿™æ˜¯é‡‘èMLä¸­æœ€å¯é çš„ç‰¹å¾é‡è¦æ€§æ–¹æ³•

**ç‰¹å¾ç­›é€‰ç»“æœ**:
- **åŸå§‹ç‰¹å¾æ•°**: 181ä¸ª (Alpha158 + FFD)
- **æ­£å‘MDAé‡è¦æ€§ç‰¹å¾**: 125ä¸ª (69%)
- **è´Ÿå‘MDAé‡è¦æ€§ç‰¹å¾**: 56ä¸ª (31%) - è¿™äº›ç‰¹å¾å®é™…ä¸Šé™ä½äº†æ¨¡å‹æ€§èƒ½!

**Top 5 Most Important Features (MDA)**:
1. **KSFT**: 0.0092 - Kçº¿å½¢æ€(Shift)
2. **KSFT2**: 0.0069 - Kçº¿å½¢æ€æ ‡å‡†åŒ–
3. **KMID2**: 0.0062 - Kçº¿ä¸­ç‚¹æ ‡å‡†åŒ–
4. **KMID**: 0.0057 - Kçº¿ä¸­ç‚¹
5. **RESI5**: 0.0042 - 5æœŸçº¿æ€§å›å½’æ®‹å·®

**å…³é”®å‘ç°**:
- Kçº¿å½¢æ€ç‰¹å¾(KSFTç³»åˆ—)è¡¨ç°æœ€ä¼˜,è¯´æ˜ä»·æ ¼å½¢æ€å¯¹é¢„æµ‹è‡³å…³é‡è¦
- è®¸å¤šFFDç‰¹å¾çš„é‡è¦æ€§ä¸ºè´Ÿå€¼,è¯´æ˜è¿‡åº¦çš„ç‰¹å¾å·¥ç¨‹å¯èƒ½å¼•å…¥å™ªéŸ³
- çŸ­æœŸæŠ€æœ¯æŒ‡æ ‡(5-10æœŸ)æ¯”é•¿æœŸæŒ‡æ ‡(50æœŸ)æ›´é‡è¦

**è¾“å‡ºæ–‡ä»¶**:
- `feature_importance_mdi.csv` - MDIé‡è¦æ€§åˆ†æ•°
- `feature_importance_mda.csv` - MDAé‡è¦æ€§åˆ†æ•°(æ¨èä½¿ç”¨)
- `selected_features.csv` - ç­›é€‰åçš„125ä¸ªæœ‰æ•ˆç‰¹å¾
- `visual_analysis/feature_importance_comparison.png` - MDI vs MDA å¯¹æ¯”å›¾
- `visual_analysis/feature_clustering.png` - ç‰¹å¾èšç±»åˆ†æ

---

### 9. ç­›é€‰ç‰¹å¾æ¨¡å‹é‡è®­ç»ƒ (Selected Features Model) âœ“
**æ–‡ä»¶**: `src/train_model.py` (ä¿®æ”¹), `src/compare_models.py` (æ–°å¢)

ä½¿ç”¨MDAç­›é€‰åçš„124ä¸ªæ­£å‘é‡è¦æ€§ç‰¹å¾é‡æ–°è®­ç»ƒäº†Random Forestæ¨¡å‹ã€‚

**æ¨¡å‹å¯¹æ¯”ç»“æœ (Purged 5-Fold CV)**:

| æŒ‡æ ‡ | Baseline (181ç‰¹å¾) | Selected (124ç‰¹å¾) | å˜åŒ– |
|------|-------------------|--------------------|------|
| **ROC AUC** | 0.5082 (+/-0.0248) | **0.5122** (+/-0.0257) | **+0.80%** âœ“ |
| **Accuracy** | 48.84% (+/-3.42%) | 48.30% (+/-3.02%) | -0.54% |

**å…³é”®å‘ç°**:
- **AUCæå‡**: æ¨¡å‹æ³›åŒ–èƒ½åŠ›æå‡0.80%
- **ç‰¹å¾å‡å°‘**: 31%çš„ç‰¹å¾è¢«ç§»é™¤(181â†’124),æ¨¡å‹æ›´ç®€æ´
- **æ–¹å·®é™ä½**: å‡†ç¡®ç‡çš„æ ‡å‡†å·®ä»3.42%é™è‡³3.02%
- **è®­ç»ƒåŠ é€Ÿ**: æ›´å°‘çš„ç‰¹å¾æ„å‘³ç€æ›´å¿«çš„è®­ç»ƒé€Ÿåº¦

**ç»“è®º**: ç‰¹å¾ç­›é€‰æˆåŠŸ! ç”¨æ›´å°‘çš„ç‰¹å¾è·å¾—äº†æ›´å¥½çš„AUC,éªŒè¯äº†MDAæ–¹æ³•èƒ½æœ‰æ•ˆè¯†åˆ«å™ªéŸ³ç‰¹å¾ã€‚

---

### 10. è¶…å‚æ•°ä¼˜åŒ– (Hyperparameter Optimization) âœ“
**æ–‡ä»¶**: `src/hyperparameter_optimization.py`

ä½¿ç”¨ **Optuna** æ¡†æ¶ç»“åˆ **Purged K-Fold CV** è¿›è¡Œäº† 50 æ¬¡è¯•éªŒçš„è¶…å‚æ•°æœç´¢ã€‚

**ä¼˜åŒ–ç»“æœ**:
- **Baseline AUC**: 0.5122
- **Optimized AUC**: **0.5241** (+2.32%)
- **Best Parameters**:
  - `n_estimators`: 1800 (Base: 1000)
  - `max_depth`: 13 (Base: 5) - æ›´æ·±çš„æ¨¡å‹æ•æ‰äº†æ›´å¤šç»†èŠ‚
  - `min_samples_leaf`: 2
  - `max_features`: 0.3 (30%)

**è¾“å‡ºæ–‡ä»¶**:
- `best_hyperparameters.csv`: æœ€ä½³å‚æ•°é…ç½®
- `feature_importance_optimized.csv`: ä¼˜åŒ–æ¨¡å‹çš„ç‰¹å¾é‡è¦æ€§
- `visual_analysis/hyperparameter_optimization.png`: ä¼˜åŒ–è¿‡ç¨‹å¯è§†åŒ–

**ç»“è®º**: é€šè¿‡å…è®¸æ¨¡å‹æ›´æ·± (max_depth=13) å¹¶ä½¿ç”¨æ›´å¤šæ ‘ (n_estimators=1800)ï¼Œæ¨¡å‹æ€§èƒ½å¾—åˆ°äº†æ˜¾è‘—æå‡ï¼ŒåŒæ—¶é€šè¿‡ Purged CV ä¿è¯äº†ç»“æœçš„ç¨³å¥æ€§ã€‚

---

### 11. Meta-Labeling (å…ƒæ ‡ç­¾) å®ç° âœ“
**æ–‡ä»¶**: `src/meta_labeling.py`

å®ç°äº† AFML Chapter 3 çš„å…ƒæ ‡ç­¾ç­–ç•¥ï¼Œè®­ç»ƒäºŒçº§æ¨¡å‹ï¼ˆMeta-Modelï¼‰æ¥è¿‡æ»¤ä¸€çº§æ¨¡å‹çš„ä¿¡å·ã€‚

**å®ç°ç»†èŠ‚**:
- **ä¸€çº§æ¨¡å‹**: Random Forest (Optimized)
- **äºŒçº§æ¨¡å‹**: Random Forest (Shallower, max_depth=7)
- **Meta-Labels**: 1 (ä¸€çº§æ¨¡å‹é¢„æµ‹æ­£ç¡®ä¸”éé›¶), 0 (ä¸€çº§æ¨¡å‹é¢„æµ‹é”™è¯¯)
- **è¾“å…¥ç‰¹å¾**: ä½¿ç”¨ä¸ä¸€çº§æ¨¡å‹ç›¸åŒçš„ç‰¹å¾é›† (124 features)
- **é¢„æµ‹æ–¹å¼**: å¦‚æœ `P(Meta=1) > 0.55`ï¼Œåˆ™æ‰§è¡Œäº¤æ˜“ï¼›å¦åˆ™è§‚æœ›ã€‚

**åˆæ­¥ç»“æœ (OOS Test)**:
- **Meta-Model AUC**: 0.4609 (ä½äºéšæœº 0.5ï¼Œè¯´æ˜ç‰¹å¾æœªèƒ½æœ‰æ•ˆåŒºåˆ†"æ­£ç¡®/é”™è¯¯")
- **ç­–ç•¥æ”¹å–„**:
    - **Base Strategy**: Return -16.35% | Sharpe -5.02 | Trades: 147
    - **Meta Strategy**: Return -3.38%  | Sharpe -2.40 | Trades: 25
- **ç»“è®º**: è™½ç„¶ Meta-Model çš„é¢„æµ‹èƒ½åŠ›è¾ƒå¼± (AUC < 0.5)ï¼Œä½†å®ƒå€¾å‘äºç»™å‡ºä½ç½®ä¿¡åº¦ï¼Œä»è€Œè¿‡æ»¤æ‰äº† **83%** çš„äº¤æ˜“ã€‚è¿™æ˜¾è‘—å‡å°‘äº†å›æ’¤ (-16% -> -3%)ï¼Œä½“ç°äº†"å®å¯é”™è¿‡ï¼Œä¸å¯åšé”™"çš„æ•ˆæœã€‚

**å…³é”®æ´å¯Ÿ**:
- å•çº¯ä½¿ç”¨åŸå§‹ç‰¹å¾å¯èƒ½ä¸è¶³ä»¥åˆ¤æ–­ä¸€çº§æ¨¡å‹å³ä½¿æ­£ç¡®ã€‚
- ä¸‹ä¸€æ­¥åº”å¼•å…¥ **ä¸€çº§æ¨¡å‹çš„ç½®ä¿¡åº¦ (Probability)** ä½œä¸ºäºŒçº§æ¨¡å‹çš„å…³é”®ç‰¹å¾ã€‚

---

## ğŸ“Š æ•°æ®è´¨é‡è¯„ä¼°

### ä¼˜ç‚¹ âœ…
1. **è®°å¿†æ€§å¢å¼º**: æ–°å¢çš„ FFD-Momentum ç‰¹å¾ç†è®ºä¸Šæ¯” ROC å…·æœ‰æ›´å¼ºçš„é¢„æµ‹èƒ½åŠ›
2. **æ ‡ç­¾å¹³è¡¡è‰¯å¥½**: Loss/Profit æ¯”ä¾‹æ¥è¿‘ 53/47
3. **æ”¶ç›Šåˆ†ç¦»æ¸…æ™°**: Loss å¹³å‡ -0.714%, Profit å¹³å‡ +0.787%
4. **ç‰¹å¾é›†å®Œå–„**: æä¾›äº† "Integer Diff (ROC)" vs "Fractional Diff (FFD)" çš„å®Œæ•´å¯¹æ¯”ç»„
5. **éªŒè¯ä¸¥è°¨**: Purged CV æˆåŠŸæ¶ˆé™¤äº† Look-ahead Biasã€‚

### éœ€è¦æ³¨æ„ âš ï¸
1. **æ¨¡å‹æ¬ æ‹Ÿåˆ**: æ·±åº¦é™åˆ¶ (max_depth=5) å¯èƒ½å¯¼è‡´æ¨¡å‹æœªèƒ½æ•æ‰å¤æ‚æ¨¡å¼ã€‚
2. **ç»´åº¦å¢åŠ **: ç‰¹å¾æ•°é‡å¢åŠ ï¼Œå»ºè®®åç»­å¢åŠ ç‰¹å¾ç­›é€‰æ­¥éª¤ (Feature Selection)ã€‚
3. **Warm-up**: FFD éœ€è¦è¾ƒé•¿çš„å†å²æ•°æ®æ¥é¢„çƒ­ï¼Œå¯¼è‡´æ—©æœŸæ ·æœ¬è¢«ä¸¢å¼ƒã€‚

---

## âš™ï¸ é¢—ç²’åº¦é…ç½® (Configuration Summary)

ä¸ºäº†ç¡®ä¿å„ç»„ä»¶çš„é¢—ç²’åº¦å¯¹é½ï¼Œä»¥ä¸‹æ˜¯å½“å‰ç³»ç»Ÿçš„æ ¸å¿ƒå‚æ•°è®¾ç½®ï¼š

| ç»„ä»¶ | å‚æ•° | å€¼ | ç‰©ç†æ—¶é—´ (ä¼°ç®—) |
|------|------|----|----------------|
| **Dollar Bars** | `daily_target` | 4 bars/day | ~6 å°æ—¶/bar (äº¤æ˜“æ—¶æ®µ) |
| **Labeling** | `vertical_barrier` | 12 bars | ~3 å¤© (æŒä»“å‘¨æœŸ) |
| **Labeling** | `volatility_span` | 100 bars | ~25 å¤© (æ³¢åŠ¨ç‡å‘¨æœŸ) |
| **Features** | `windows` | [5, 10, 20, 30, 50] | 1.25å¤© ~ 12.5å¤© |
| **CV** | `embargo` | 1% | ~10 å¤© |

**å¯¹é½åˆ†æ**:
- **ç‰¹å¾ vs æ ‡ç­¾**: ç‰¹å¾çª—å£ (1.25~12.5å¤©) è¦†ç›–äº† æ ‡ç­¾å‘¨æœŸ (3å¤©) çš„çŸ­ã€ä¸­ã€é•¿æœŸå½±å“ï¼Œè®¾ç½®åˆç†ã€‚
- **æ³¢åŠ¨ç‡ vs æ ‡ç­¾**: æ³¢åŠ¨ç‡è®¡ç®—çª—å£ (25å¤©) è¿œå¤§äºæŒä»“å‘¨æœŸ (3å¤©)ï¼Œæä¾›äº†ç¨³å®šçš„åŸºå‡†ã€‚
- **Baré¢‘ç‡**: æ¯æ—¥4æ ¹Baræä¾›äº†ä¸€å®šçš„æ—¥å†…ç»†èŠ‚ï¼ŒåŒæ—¶é¿å…äº†é«˜é¢‘å™ªéŸ³ã€‚

---

## ğŸ¯ ä¸‹ä¸€æ­¥è§„åˆ’ (Future Work)

å½“å‰æ¨¡å‹å·²å®Œæˆè¶…å‚æ•°ä¼˜åŒ– (AUC=0.5241)ã€‚æ¥ä¸‹æ¥çš„å·¥ä½œå°†èšç„¦äºæ¨¡å‹æ¶æ„å‡çº§å’Œç­–ç•¥ä¼˜åŒ–ã€‚

### 1. Meta-Labeling ä¼˜åŒ– - ä¼˜å…ˆçº§: é«˜ ğŸ”¥
- **é—®é¢˜**: äºŒçº§æ¨¡å‹ AUC (0.46) è¾ƒä½ï¼Œæœªèƒ½æœ‰æ•ˆè¯†åˆ«çœŸæ­£çš„è·åˆ©æœºä¼šã€‚
- **è¡ŒåŠ¨**: å°†ä¸€çº§æ¨¡å‹çš„ **é¢„æµ‹æ¦‚ç‡ (Prediction Probability)** åŠ å…¥åˆ°äºŒçº§æ¨¡å‹çš„ç‰¹å¾é›†ä¸­ã€‚é€šå¸¸ï¼Œä¸€çº§æ¨¡å‹éå¸¸æœ‰æŠŠæ¡ (Prob > 0.8) æˆ–éå¸¸æ²¡æŠŠæ¡ (Prob < 0.55) æ—¶ï¼ŒäºŒçº§æ¨¡å‹æ›´å®¹æ˜“åˆ¤æ–­ã€‚

### 2. æ¨¡å‹å‡çº§: XGBoost/LightGBM - ä¼˜å…ˆçº§: ä¸­
- **ç›®æ ‡**: ä½¿ç”¨æ¢¯åº¦æå‡æ ‘ (GBDT) æ›¿ä»£éšæœºæ£®æ—ã€‚
- **ä¾æ®**: GBDT åœ¨å¤„ç†éçº¿æ€§ç‰¹å¾äº¤äº’æ–¹é¢é€šå¸¸ä¼˜äº RFï¼Œä¸”è®­ç»ƒé€Ÿåº¦æ›´å¿«ã€‚
- **è¡ŒåŠ¨**: å¼•å…¥ `xgboost` æˆ– `lightgbm` åº“ï¼Œå¹¶åœ¨åŒæ ·ä¸¥è°¨çš„ Purged CV æ¡†æ¶ä¸‹æµ‹è¯•ã€‚

### 3. Bet Sizing (ä»“ä½ç®¡ç†) - ä¼˜å…ˆçº§: ä¸­
- **ç›®æ ‡**: åŠ¨æ€è°ƒæ•´ä»“ä½å¤§å°ã€‚
- **ä¾æ®**: AFML Chapter 10ã€‚ä¸ä»…è¦é¢„æµ‹æ–¹å‘ï¼Œè¿˜è¦æ ¹æ®ä¿¡å·çš„ç½®ä¿¡åº¦ (Probability) å†³å®šä¸‹æ³¨å¤§å°ã€‚
- **è¡ŒåŠ¨**: å®ç°åŸºäº Kelly Criterion æˆ– Meta-Labeling æ¦‚ç‡çš„ä»“ä½ç®¡ç†é€»è¾‘ã€‚

---

## ğŸ“ å½“å‰é¡¹ç›®ç»“æ„

```
AFML/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ process_bars.py          # Dollar bars ç”Ÿæˆ
â”‚   â”œâ”€â”€ labeling.py              # Triple barrier æ ‡ç­¾
â”‚   â”œâ”€â”€ features.py              # Alpha158 + FFD å¢å¼ºç‰¹å¾å·¥ç¨‹
â”‚   â”œâ”€â”€ sample_weights.py        # æ ·æœ¬æƒé‡è®¡ç®—
â”‚   â”œâ”€â”€ cv_setup.py              # äº¤å‰éªŒè¯é…ç½®
â”‚   â”œâ”€â”€ train_model.py           # æ¨¡å‹è®­ç»ƒ (è‡ªåŠ¨ä½¿ç”¨ç­›é€‰ç‰¹å¾)
â”‚   â”œâ”€â”€ feature_importance.py    # ç‰¹å¾é‡è¦æ€§åˆ†æ (MDI/MDA)
â”‚   â”œâ”€â”€ compare_models.py        # æ¨¡å‹å¯¹æ¯”è„šæœ¬
â”‚   â””â”€â”€ hyperparameter_optimization.py # è¶…å‚æ•°ä¼˜åŒ– (Optuna)
â”œâ”€â”€ features_labeled.csv         # å®Œæ•´è®­ç»ƒæ•°æ® (Features + Labels + Weights)
â”œâ”€â”€ selected_features.csv        # MDAç­›é€‰åçš„124ä¸ªæœ‰æ•ˆç‰¹å¾
â”œâ”€â”€ feature_importance_mda.csv   # MDAé‡è¦æ€§åˆ†æ•°
â”œâ”€â”€ feature_importance_optimized.csv # ä¼˜åŒ–åçš„ç‰¹å¾é‡è¦æ€§
â”œâ”€â”€ best_hyperparameters.csv     # æœ€ä½³è¶…å‚æ•°é…ç½®
â””â”€â”€ visual_analysis/
    â”œâ”€â”€ feature_importance_comparison.png  # MDI vs MDA å¯¹æ¯”
    â”œâ”€â”€ feature_clustering.png   # ç‰¹å¾èšç±»åˆ†æ
    â””â”€â”€ cv_splits.png            # CV åˆ†å‰²ç¤ºæ„å›¾
```

